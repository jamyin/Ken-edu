<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.ssic.education.common.mapper.ProSupplierExMapper">


	<select id="findSupplierIdByName" resultType="String">
		SELECT
		a.id
		FROM
		t_pro_supplier a
		WHERE
		a.supplier_name = #{supplierName}
	</select>

	<select id="findProSupplier"
		resultType="com.ssic.education.common.provider.dto.SupplierDto">
		SELECT
		id,
		supplier_name supplierName,
		address,
		provinces,
		city,
		area,
		supplier_type supplierType,
		business_license businessLicense,
		organization_code organizationCode,
		food_service_code foodServiceCode,
		food_service_code_date foodServiceCodeDate,
		food_business_code
		foodBusinessCode,
		food_business_code_date foodBusinessCodeDate,
		food_circulation_code foodCirculationCode,
		food_circulation_code_date
		foodCirculationCodeDate,
		food_produce_code foodProduceCode,
		food_produce_code_date foodProduceCodeDate,	
		corporation,
		contact_way contactWay,
		longitude,
		latitude,		
		b.supplier_code  as  supplierCode
		FROM
			t_pro_supplier a  ,
			t_pro_supplier_receiver b
		WHERE
		stat = 1  AND
		
		b.supplier_id=a.id
		<include refid="where_findSupplier"></include>
		ORDER BY   a.create_time DESC
		<if test="ph.rows!=0 and ph!=null">
			limit #{ph.beginRow},#{ph.rows}
		</if>
	</select>

	<select id="findSupplierDetail" resultType="com.ssic.education.common.dto.ProSupplierDto"
		parameterType="java.lang.String">
		SELECT
		a.id,a.supplier_name AS
		supplierName,a.address,a.provinces,a.city,a.area,a.supplier_type
		AS
		supplierType,a.business_license AS
		businessLicense,a.organization_code
		AS
		organizationCode,a.corporation,a.contact_way AS
		contactWay,a.longitude,a.latitude,a.create_time AS
		createTime,a.last_update_time AS lastUpdateTime,a.stat,
		b.lic_name AS
		licName,b.lic_no AS licNo,b.lic_type AS licType,b.lic_end_date AS
		licEndDate,b.lic_pic AS licPic
		FROM
		t_pro_supplier a
		LEFT JOIN
		t_pro_license b
		ON a.id = b.relation_id
		WHERE
		a.id = #{id} AND a.stat = 1
		AND b.stat = 1
		ORDER BY a.create_time DESC
	</select>
	<select id="findProSupplierById"
		resultType="com.ssic.education.common.provider.dto.SupplierDto">
		SELECT

	a.id,
	a.supplier_name supplierName,
	a.address,
	a.provinces,
	a.city,
	a.area,
	a.supplier_type supplierType,
	a.business_license businessLicense,
	a.organization_code organizationCode,
	a.food_service_code foodServiceCode,
	a.food_service_code_date foodServiceCodeDate,
	a.food_business_code foodBusinessCode,
	a.food_business_code_date foodBusinessCodeDate,
	a.food_circulation_code foodCirculationCode,
	a.food_circulation_code_date foodCirculationCodeDate,
	a.food_produce_code foodProduceCode,
	a.food_produce_code_date foodProduceCodeDate,
	a.corporation,
	a.contact_way contactWay,
	a.longitude,
	a.latitude,
  b.supplier_code  AS supplierCode
FROM
	t_pro_supplier a,
t_pro_supplier_receiver b
WHERE
 b.supplier_id=#{id}
AND  a.stat=1 AND  a.id=#{id}
	</select>
	<sql id="where_findSupplier">
		<if test="supplierDto.supplierName!=null and  supplierDto.supplierName!=''">
			AND supplier_name = #{supplierDto.supplierName}
		</if>
		<if test="supplierDto.address!=null and supplierDto.address!='' ">
			AND address = #{supplierDto.address}
		</if>
		<if test="supplierDto.supplierType!=null and supplierDto.supplierType!='' ">
			AND supplier_type = #{supplierDto.supplierType}
		</if>
		<if test="supplierDto.receiverId!=null and supplierDto.receiverId!='' ">
			AND b.receiver_id=  #{supplierDto.receiverId}
		</if>
		
	</sql>

	<insert id="insert" parameterType="com.ssic.education.common.provider.dto.SupplierDto">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon May 16 
			10:22:46 CST 2016. -->
		insert into t_pro_supplier (id, supplier_name, address,
		provinces, city, area,
		supplier_type, business_license, organization_code,
		food_service_code, food_service_code_date, food_business_code,
		food_business_code_date, food_circulation_code,
		food_circulation_code_date, food_produce_code,
		food_produce_code_date, 
		corporation, contact_way, longitude,
		latitude, create_time, last_update_time,
		stat)
		values (#{id,jdbcType=VARCHAR}, #{supplierName,jdbcType=VARCHAR},
		#{address,jdbcType=VARCHAR},
		#{provinces,jdbcType=VARCHAR}, #{city,jdbcType=VARCHAR}, #{area,jdbcType=VARCHAR},
		#{supplierType,jdbcType=INTEGER}, #{businessLicense,jdbcType=VARCHAR},
		#{organizationCode,jdbcType=VARCHAR},
		#{foodServiceCode,jdbcType=VARCHAR},
		#{foodServiceCodeDate,jdbcType=DATE},
		#{foodBusinessCode,jdbcType=VARCHAR},
		#{foodBusinessCodeDate,jdbcType=DATE},
		#{foodCirculationCode,jdbcType=VARCHAR},
		#{foodCirculationCodeDate,jdbcType=DATE},
		#{foodProduceCode,jdbcType=VARCHAR},
		#{foodProduceCodeDate,jdbcType=DATE}, #{code,jdbcType=VARCHAR},
	
		#{corporation,jdbcType=VARCHAR}, #{contactWay,jdbcType=VARCHAR}, #{longitude,jdbcType=VARCHAR},
		#{latitude,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},
		#{lastUpdateTime,jdbcType=TIMESTAMP},
		#{stat,jdbcType=INTEGER})
	</insert>

	<update id="updateByPrimaryKeySelective" parameterType="com.ssic.education.common.provider.dto.SupplierDto">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon May 16 
			10:22:46 CST 2016. -->
		update t_pro_supplier
		<set>
			<if test="supplierName != null">
				supplier_name = #{supplierName,jdbcType=VARCHAR},
			</if>
			<if test="address != null">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="provinces != null">
				provinces = #{provinces,jdbcType=VARCHAR},
			</if>
			<if test="city != null">
				city = #{city,jdbcType=VARCHAR},
			</if>
			<if test="area != null">
				area = #{area,jdbcType=VARCHAR},
			</if>
			<if test="supplierType != null">
				supplier_type = #{supplierType,jdbcType=INTEGER},
			</if>
			<if test="businessLicense != null">
				business_license = #{businessLicense,jdbcType=VARCHAR},
			</if>
			<if test="organizationCode != null">
				organization_code = #{organizationCode,jdbcType=VARCHAR},
			</if>
			<if test="foodServiceCode != null">
				food_service_code = #{foodServiceCode,jdbcType=VARCHAR},
			</if>
			<if test="foodServiceCodeDate != null">
				food_service_code_date =
				#{foodServiceCodeDate,jdbcType=DATE},
			</if>
			<if test="foodBusinessCode != null">
				food_business_code =
				#{foodBusinessCode,jdbcType=VARCHAR},
			</if>
			<if test="foodBusinessCodeDate != null">
				food_business_code_date =
				#{foodBusinessCodeDate,jdbcType=DATE},
			</if>
			<if test="foodCirculationCode != null">
				food_circulation_code =
				#{foodCirculationCode,jdbcType=VARCHAR},
			</if>
			<if test="foodCirculationCodeDate != null">
				food_circulation_code_date =
				#{foodCirculationCodeDate,jdbcType=DATE},
			</if>
			<if test="foodProduceCode != null">
				food_produce_code = #{foodProduceCode,jdbcType=VARCHAR},
			</if>
			<if test="foodProduceCodeDate != null">
				food_produce_code_date =
				#{foodProduceCodeDate,jdbcType=DATE},
			</if>
			
			
			<if test="corporation != null">
				corporation = #{corporation,jdbcType=VARCHAR},
			</if>
			<if test="contactWay != null">
				contact_way = #{contactWay,jdbcType=VARCHAR},
			</if>
			<if test="longitude != null">
				longitude = #{longitude,jdbcType=VARCHAR},
			</if>
			<if test="latitude != null">
				latitude = #{latitude,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastUpdateTime != null">
				last_update_time = #{lastUpdateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="stat != null">
				stat = #{stat,jdbcType=INTEGER},
			</if>
		</set>
		where id = #{id,jdbcType=VARCHAR}
	</update>
	
	<select id="lookRelatingWares"  resultType="com.ssic.education.common.dto.ProSupplierDto"  parameterType="com.ssic.education.common.dto.ProSupplierDto">
	
					SELECT
				
					a.wares_name AS waresName,
				a.spec AS spec
				
				FROM
				
					t_pro_wares a
				WHERE
					a.supplier_id =#{dto.id} 
					AND
				a.way=0
				AND a.stat=1 

	</select>
	<select id="findSupplierCodeByReceiverId"
		resultType="com.ssic.education.common.provider.dto.SupplierDto">
	
	
	SELECT
	a.supplier_code AS supplierCode
FROM
	t_pro_supplier_receiver a
WHERE
	a.receiver_id = #{supplierId}
	
	</select>
	
	
	
	
	
</mapper>
