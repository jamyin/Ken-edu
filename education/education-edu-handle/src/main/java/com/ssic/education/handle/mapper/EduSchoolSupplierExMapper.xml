<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ssic.education.handle.mapper.EduSchoolSupplierExMapper" >
	
	<resultMap id="BaseResultMap" type="com.ssic.educateion.common.dto.SupplierDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 26 19:23:18 CST 2016.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="supplier_name" property="supplierName" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="provinces" property="provinces" jdbcType="VARCHAR" />
    <result column="city" property="city" jdbcType="VARCHAR" />
    <result column="area" property="area" jdbcType="VARCHAR" />
    <result column="supplier_type" property="supplierType" jdbcType="INTEGER" />
    <result column="business_license" property="businessLicense" jdbcType="VARCHAR" />
    <result column="organization_code" property="organizationCode" jdbcType="VARCHAR" />
    <result column="food_service_code" property="foodServiceCode" jdbcType="VARCHAR" />
    <result column="food_service_code_date" property="foodServiceCodeDate" jdbcType="DATE" />
    <result column="food_business_code" property="foodBusinessCode" jdbcType="VARCHAR" />
    <result column="food_business_code_date" property="foodBusinessCodeDate" jdbcType="DATE" />
    <result column="food_circulation_code" property="foodCirculationCode" jdbcType="VARCHAR" />
    <result column="food_circulation_code_date" property="foodCirculationCodeDate" jdbcType="DATE" />
    <result column="food_produce_code" property="foodProduceCode" jdbcType="VARCHAR" />
    <result column="food_produce_code_date" property="foodProduceCodeDate" jdbcType="DATE" />
    <result column="corporation" property="corporation" jdbcType="VARCHAR" />
    <result column="id_card" property="idCard" jdbcType="VARCHAR" />
    <result column="id_type" property="idType" jdbcType="VARCHAR" />
    <result column="contact_way" property="contactWay" jdbcType="VARCHAR" />
    <result column="longitude" property="longitude" jdbcType="VARCHAR" />
    <result column="latitude" property="latitude" jdbcType="VARCHAR" />
    <result column="reviewed" property="reviewed" jdbcType="TINYINT" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="last_update_time" property="lastUpdateTime" jdbcType="TIMESTAMP" />
    <result column="stat" property="stat" jdbcType="INTEGER" />
  </resultMap>
	
	
	<select id="searchEduSchoolSupplierListDto" resultMap="BaseResultMap">
		SELECT * FROM t_pro_supplier ps WHERE EXISTS  
		(
			SELECT * FROM `t_edu_school_supplier` ess WHERE ess.stat = 1 and  ess.`school_id`=#{schoolId} AND ps.`id` = ess.`supplier_id`
		);
	</select>
	
	<select id="countAllLedgerAddress" resultType="Long">
		SELECT
		count(b.id)
		FROM
		t_edu_school a,t_edu_school_supplier b
		WHERE
		b.stat = 1
		AND a.id=b.school_id
		AND b.supplier_id=#{ledgerAddress.supplierId}
		<if
			test="ledgerAddress.schoolName!=null and  ledgerAddress.schoolName!=''">
			AND a.school_name like "%"#{ledgerAddress.schoolName}"%"
		</if>
	</select>

	<select id="findAllLedgerAddress" resultType="com.ssic.educateion.common.dto.LedgerAddressDto">
		SELECT
		b.id id,
		a.school_name schoolName,
		a.mobile_no mobileNo,
		b.school_id schoolId,
		a.address address,
		a.contacts contacts,
		b.supplier_id supplierId,
		b.create_time
		FROM
		t_edu_school a,t_edu_school_supplier b
		WHERE
		b.stat = 1
		AND a.id=b.school_id
		AND b.supplier_id=#{ledgerAddress.supplierId}
		<if
			test="ledgerAddress.schoolName!=null and  ledgerAddress.schoolName!=''">
			AND a.school_name like "%"#{ledgerAddress.schoolName}"%"
		</if>
		ORDER BY b.create_time DESC
		<if test="ph!=null and ph.rows!=0">
			limit #{ph.beginRow},#{ph.rows}
		</if>
	</select>

	<select id="findSchoolIdByReceiverId" resultType="java.lang.String">
		SELECT
		a.school_id
		FROM t_edu_school_supplier a,t_edu_school b
		WHERE
		a.school_id=b.id
		AND a.supplier_id=#{sourceId}
		AND
		trim(b.school_name)=#{receiverName}
		AND a.stat = 1
	</select>

</mapper>